{
  "method_name": "query",
  "url": "https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/timestream-query/client/query.html",
  "description": "Query is a synchronous operation that enables you to run a query against your Amazon Timestream data. If you enabled QueryInsights, this API also returns insights and metrics related to the query that you executed. QueryInsights helps with performance tuning of your query. For more information about QueryInsights, see Using query insights to optimize queries in Amazon Timestream. Query will time out after 60 seconds. You must update the default timeout in the SDK to support a timeout of 60 seconds. See the code sample for details. Your query request will fail in the following cases:",
  "parameters": [
    {
      "name": "QueryString",
      "type": "string",
      "required": true,
      "description": "The query to be run by Timestream.",
      "nested_params": []
    },
    {
      "name": "ClientToken",
      "type": "string",
      "required": false,
      "description": "Unique, case-sensitive string of up to 64 ASCII characters specified when a Query request is made. Providing a ClientToken makes the call to Query idempotent. This means that running the same query repeatedly will produce the same result. In other words, making multiple identical Query requests has the same effect as making a single request. When using ClientToken in a query, note the following: If the Query API is instantiated without a ClientToken, the Query SDK generates a ClientToken on your behalf. If the Query invocation only contains the ClientToken but does not include a NextToken, that invocation of Query is assumed to be a new query run. If the invocation contains NextToken, that particular invocation is assumed to be a subsequent invocation of a prior call to the Query API, and a result set is returned. After 4 hours, any request with the same ClientToken is treated as a new request. This field is autopopulated if not provided.",
      "nested_params": []
    },
    {
      "name": "NextToken",
      "type": "string",
      "required": false,
      "description": "A pagination token used to return a set of results. When the Query API is invoked using NextToken, that particular invocation is assumed to be a subsequent invocation of a prior call to Query, and a result set is returned. However, if the Query invocation only contains the ClientToken, that invocation of Query is assumed to be a new query run. Note the following when using NextToken in a query: A pagination token can be used for up to five Query invocations, OR for a duration of up to 1 hour --- whichever comes first. Using the same NextToken will return the same set of records. To keep paginating through the result set, you must to use the most recent nextToken. Suppose a Query invocation returns two NextToken values, TokenA and TokenB. If TokenB is used in a subsequent Query invocation, then TokenA is invalidated and cannot be reused. To request a previous result set from a query after pagination has begun, you must re-invoke the Query API. The latest NextToken should be used to paginate until null is returned, at which point a new NextToken should be used. If the IAM principal of the query initiator and the result reader are not the same and/or the query initiator and the result reader do not have the same query string in the query requests, the query will fail with an Invalid pagination token error.",
      "nested_params": []
    },
    {
      "name": "MaxRows",
      "type": "integer",
      "required": false,
      "description": "The total number of rows to be returned in the Query output. The initial run of Query with a MaxRows value specified will return the result set of the query in two cases: The size of the result is less than 1MB. The number of rows in the result set is less than the value of maxRows. Otherwise, the initial invocation of Query only returns a NextToken, which can then be used in subsequent calls to fetch the result set. To resume pagination, provide the NextToken value in the subsequent command. If the row size is large (e.g. a row has many columns), Timestream may return fewer rows to keep the response size from exceeding the 1 MB limit. If MaxRows is not provided, Timestream will send the necessary number of rows to meet the 1 MB limit.",
      "nested_params": []
    },
    {
      "name": "QueryInsights",
      "type": "dict",
      "required": true,
      "description": "Encapsulates settings for enabling QueryInsights. Enabling QueryInsights returns insights and metrics in addition to query results for the query that you executed. You can use QueryInsights to tune your query performance. Provides the following modes to enable QueryInsights: ENABLED_WITH_RATE_CONTROL --- Enables QueryInsights for the queries being processed. This mode also includes a rate control mechanism, which limits the QueryInsights feature to 1 query per second (QPS). DISABLED --- Disables QueryInsights.",
      "nested_params": [
        {
          "name": "Mode",
          "type": "string",
          "required": false,
          "description": "Provides the following modes to enable QueryInsights:",
          "nested_params": []
        }
      ]
    }
  ],
  "return_structure": [
    {
      "name": "",
      "type": "dict",
      "description": "",
      "nested_items": [
        {
          "name": "QueryId",
          "type": "string",
          "description": "A unique ID for the given query.",
          "nested_items": []
        },
        {
          "name": "NextToken",
          "type": "string",
          "description": "A pagination token that can be used again on a Query call to get the next set of results.",
          "nested_items": []
        },
        {
          "name": "Rows",
          "type": "list",
          "description": "The result set rows returned by the query.",
          "nested_items": [
            {
              "name": "",
              "type": "dict",
              "description": "",
              "nested_items": [
                {
                  "name": "Data",
                  "type": "list",
                  "description": "List of data points in a single row of the result set.",
                  "nested_items": [
                    {
                      "name": "",
                      "type": "dict",
                      "description": "",
                      "nested_items": [
                        {
                          "name": "ScalarValue",
                          "type": "string",
                          "description": "Indicates if the data point is a scalar value such as integer, string, double, or Boolean.",
                          "nested_items": []
                        },
                        {
                          "name": "TimeSeriesValue",
                          "type": "list",
                          "description": "Indicates if the data point is a timeseries data type.",
                          "nested_items": [
                            {
                              "name": "",
                              "type": "dict",
                              "description": "",
                              "nested_items": [
                                {
                                  "name": "Time",
                                  "type": "string",
                                  "description": "The timestamp when the measure value was collected.",
                                  "nested_items": []
                                },
                                {
                                  "name": "",
                                  "type": "dict",
                                  "description": "",
                                  "nested_items": []
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "name": "ArrayValue",
                          "type": "list",
                          "description": "Indicates if the data point is an array.",
                          "nested_items": []
                        },
                        {
                          "name": "",
                          "type": "dict",
                          "description": "",
                          "nested_items": []
                        },
                        {
                          "name": "NullValue",
                          "type": "boolean",
                          "description": "Indicates if the data point is null.",
                          "nested_items": []
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "ColumnInfo",
          "type": "list",
          "description": "The column data types of the returned result set.",
          "nested_items": [
            {
              "name": "",
              "type": "dict",
              "description": "",
              "nested_items": [
                {
                  "name": "Name",
                  "type": "string",
                  "description": "The name of the result set column. The name of the result set is available for columns of all data types except for arrays.",
                  "nested_items": []
                },
                {
                  "name": "",
                  "type": "dict",
                  "description": "",
                  "nested_items": [
                    {
                      "name": "ScalarType",
                      "type": "string",
                      "description": "Indicates if the column is of type string, integer, Boolean, double, timestamp, date, time. For more information, see Supported data types.",
                      "nested_items": []
                    },
                    {
                      "name": "ArrayColumnInfo",
                      "type": "dict",
                      "description": "Indicates if the column is an array.",
                      "nested_items": []
                    },
                    {
                      "name": "TimeSeriesMeasureValueColumnInfo",
                      "type": "dict",
                      "description": "Indicates if the column is a timeseries data type.",
                      "nested_items": []
                    },
                    {
                      "name": "RowColumnInfo",
                      "type": "list",
                      "description": "Indicates if the column is a row.",
                      "nested_items": []
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "QueryStatus",
          "type": "dict",
          "description": "Information about the status of the query, including progress and bytes scanned.",
          "nested_items": [
            {
              "name": "ProgressPercentage",
              "type": "float",
              "description": "The progress of the query, expressed as a percentage.",
              "nested_items": []
            },
            {
              "name": "CumulativeBytesScanned",
              "type": "integer",
              "description": "The amount of data scanned by the query in bytes. This is a cumulative sum and represents the total amount of bytes scanned since the query was started.",
              "nested_items": []
            },
            {
              "name": "CumulativeBytesMetered",
              "type": "integer",
              "description": "The amount of data scanned by the query in bytes that you will be charged for. This is a cumulative sum and represents the total amount of data that you will be charged for since the query was started. The charge is applied only once and is either applied when the query completes running or when the query is cancelled.",
              "nested_items": []
            }
          ]
        },
        {
          "name": "QueryInsightsResponse",
          "type": "dict",
          "description": "Encapsulates QueryInsights containing insights and metrics related to the query that you executed.",
          "nested_items": [
            {
              "name": "QuerySpatialCoverage",
              "type": "dict",
              "description": "Provides insights into the spatial coverage of the query, including the table with sub-optimal (max) spatial pruning. This information can help you identify areas for improvement in your partitioning strategy to enhance spatial pruning.",
              "nested_items": [
                {
                  "name": "",
                  "type": "dict",
                  "description": "",
                  "nested_items": [
                    {
                      "name": "",
                      "type": "",
                      "description": "Value --- The maximum ratio of spatial coverage.",
                      "nested_items": []
                    },
                    {
                      "name": "",
                      "type": "ARN",
                      "description": "TableArn --- The Amazon Resource Name (ARN) of the table with sub-optimal spatial pruning.",
                      "nested_items": []
                    },
                    {
                      "name": "",
                      "type": "",
                      "description": "PartitionKey --- The partition key used for partitioning, which can be a default measure_name or a CDPK.",
                      "nested_items": []
                    }
                  ]
                }
              ]
            },
            {
              "name": "QueryTemporalRange",
              "type": "dict",
              "description": "Provides insights into the temporal range of the query, including the table with the largest (max) time range. Following are some of the potential options for optimizing time-based pruning:",
              "nested_items": [
                {
                  "name": "",
                  "type": "",
                  "description": "Add missing time-predicates.",
                  "nested_items": []
                },
                {
                  "name": "",
                  "type": "",
                  "description": "Remove functions around the time predicates.",
                  "nested_items": []
                },
                {
                  "name": "",
                  "type": "",
                  "description": "Add time predicates to all the sub-queries.",
                  "nested_items": []
                }
              ]
            },
            {
              "name": "QueryTableCount",
              "type": "integer",
              "description": "Indicates the number of tables in the query.",
              "nested_items": []
            },
            {
              "name": "OutputRows",
              "type": "integer",
              "description": "Indicates the total number of rows returned as part of the query result set. You can use this data to validate if the number of rows in the result set have changed as part of the query tuning exercise.",
              "nested_items": []
            },
            {
              "name": "OutputBytes",
              "type": "integer",
              "description": "Indicates the size of query result set in bytes. You can use this data to validate if the result set has changed as part of the query tuning exercise.",
              "nested_items": []
            },
            {
              "name": "UnloadPartitionCount",
              "type": "integer",
              "description": "Indicates the partitions created by the Unload operation.",
              "nested_items": []
            },
            {
              "name": "UnloadWrittenRows",
              "type": "integer",
              "description": "Indicates the rows written by the Unload query.",
              "nested_items": []
            },
            {
              "name": "UnloadWrittenBytes",
              "type": "integer",
              "description": "Indicates the size, in bytes, written by the Unload operation.",
              "nested_items": []
            }
          ]
        }
      ]
    }
  ]
}